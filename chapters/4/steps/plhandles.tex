\section{Attach Handles}
\label{section:pl-handle}

At this point in the chapter we have constructed a 4--manifold triangulation $W$ with two boundary components, each equivalent to the 3--dimensional cell complex $M$ obtained in Section \ref{section:pl-subdivide}.
Furthermore, the cells of $M$ are partitioned into subcomplexes analogous to the face, edge, and vertex blocks of Chapter \ref{chapter:smooth}.
Explicit attachment sites are available for 2--handles, so our first step is construction of a 2--handle.

\subsection{Attach 2--handles}
\label{section:pl-2-handle}

The algorithm of this subsection takes as input a pair $(T,\Gamma)$ where $T$ is a closed solid torus triangulation and $\Gamma$ is a collection of triangulated disjoint parallel longitudes in the boundary of $T$.
The output is a 4--disk triangulation $H$ satisfying the following:
\begin{enumerate}
	\item $\pd H$ is a triangulated $S^3$ with a genus 1 Heegard splitting over $\pd T$, i.e.\ $\pd H\setminus \interior{T}$ is a solid torus.
	\item For each $\gamma_i$ in $\Gamma$, $\gamma_i$ bounds a triangulated disk in $\pd H$, i.e.\ each $\gamma_i$ is an explicit 0-framing for the 2--handle attachment.
\end{enumerate}
We take $H$ to be a 4--dimensional 2--handle and attach $H$ to $W$ over $T$.
Constructing the 2--handle involves building a solid torus $T'$ that complements $T$, combining $T$ and $T'$ over their shared boundary to build a triangulated 3--sphere, then coning that 3--sphere into the 4--disk $H$.

We find pairs $(T,\Gamma)$ inside of $M_1\subset\pd W$, the subdivision of $N$ induced by the subdividing map $f:N\to\RR$.
Let $B$ be a face block analogue of $M_1$.
$B$ is a 3--dimensional subcomplex of $M_1$ that forms a closed solid torus,
% Prove?
and $B$ projects through $f$ over an $n$--gon for some $n$.
Call the $n$ corners of $f(B)$ by $c_i$, $i=1\dots n$, and take $C=\{c_1\dots c_n\}$.
Then the $f\inv c_i$ are disjoint parallel triangulated longitudes of $B$.
We take $(B, f\inv C)$ as our pair $(T,\Gamma)$ for each face block analogue $B$ of $M$.

For a closed solid torus $T$, we find a complementary torus $T'$, i.e.\ $\pd T=\pd T'$ as triangulations.
We begin by investigating the boundary of $T$, setting $T_0'=\pd T$.
Inside of $T_0'$ is the set of disjoint parallel longitudes $\Gamma$ that are required to bound disks inside of $T'$, so for each $\gamma_i$ we attach a disk $D_i$ with $\pd D_i=\gamma_i$ to $T'_0$ over $\gamma_i$.
Call the result of these attachments $T_1'$.
Adjacent longitudes $\gamma_i$ and $\gamma_j$ bound an annulus $A_{ij}$ in $T_1'$, and $D_i \cup A_{ij}\cup D_j$ is a triangulated 2--sphere that we cone into a 3--disk $D_{ij}$.
For each $ij$, we attach the 3--disk $D_{ij}$ to $T_1'$ over $D_i\cup A_{ij}\cup D_j$ to form the closed solid torus $T'$.

By construction, $\pd T'=\pd T$, so $T$ and $T'$ are complementary. Moreover, $\gamma_i\subset \pd T'$ explicitly bounds a triangulated disk in $T'$, thus the $\gamma_i$ are meridians of $T'$.
We glue $T$ to $T'$ over their shared boundary to form a 3--sphere, then cone that 3--sphere into a 4--disk with an explicit 2--handle structure.
We find a 2--handle for each face block analogue by iterating Algorithm \ref{alg:build-2-handle} over the face block analogues of $M_1\subset \pd W$, and attach these 2--handles to $W$, forming $W'$.

\begin{algorithm}[h!]
	\caption{Constructing a 2--handle}
	\label{alg:build-2-handle}
	\KwData{A pair $(T,\Gamma)$ where $T$ is a closed solid torus triangulation and $\Gamma$ is a collection of disjoint parallel triangulated longitudes in $\pd T$}
	\KwResult{A 4--disk $H_T^2$ such that $\pd H_T^2$ is a triangulated 3--sphere with genus 1 Heegard splitting over $\pd T$ and such that $\gamma_i\in\Gamma$ bounds a triangulated disk in $\pd H_T^2\setminus \interior{T}$ for each $i$}
	\Begin{
		First, we construct a complementary solid torus $T'$ with $\pd T=\pd T'$\;
		$T_0'=\pd T$\;
		\ForEach{$\gamma_i\in \Gamma$}{
			$D_i=C(\gamma_i)$, the cone of $\gamma_i$\;
		}
		$T_1'=T_0'\cup\{D_i\}/\sim$, where $\sim$ is induced by 
%		defined by $g\sim \iota (g)$, $\iota$ 
%		the identity
%		 map
			$\pd D_i=\gamma_i\overset{\iota}{\to}\gamma_i\subset T_0'$\;
		\ForEach{adjacent pair of longitudes $\gamma_i,\gamma_j$ from $\Gamma$}{
			$A_{ij}=$ the annulus in $T_1'$ bounded by $\gamma_i$ and $\gamma_j$\;
			$S_{ij}=$ the triangulated 2--sphere in $T_1'$ bounded by $D_i\cup A_{ij}\cup D_j$\;
			$D_{ij}=C(S_{ij})$, the cone of $S_{ij}$\;
		}
		$T'=T_1'\cup\{D_{ij}/\sim\}$, where $\sim$ is induced by
%		 defined by $s\sim\iota(s)$, $\iota$ the identity map
			$\pd D_{ij}=S_{ij}\overset{\iota}{\to}S_{ij}\subset T_1'$\;
		$S_T^3=T\cup T'/\sim$, where $\sim$ is induced by
%		 defined by $t\sim\iota(t)$, $\iota$ the identity map 
		 	$\pd T\overset{\iota}{\to}\pd T'$\;
		$H_T^2=C(S_T^3)$, the cone of $S_T^3$\;
	}
\end{algorithm}

Let $\mathfrak{B}$ be the collection of face block analogues of $M_1\subset \pd W$.
Iterating Algorithm \ref{alg:build-2-handle} over $\mathfrak{B}$ yields a collection of 4--dimensional 2--handles $\{H_B^2\}_{B\in\mathfrak{B}}$.
The face block analogues in $\mathfrak{B}$ are disjoint by construction, so we attach our 2--handles in any order.
We form the 4--manifold triangulation $W'$ from $W$ as
\[
	W' = W\cup\{H_B^2\}_{B\in\mathfrak{B}}/\sim,
\]
where $\sim$ is defined by $b\sim \iota(b)$, $\iota$ the identity map $H_B^2\supset B\overset{\iota}{\to} B\subset M_1$.

%$B$ possesses the structure of a 3--disk if and only if for some edge $e$ of $B$
%The preimages of the corners of $f(B)$ are parallel longitudes of $B$, and we form a triangulated 2--handle containing $B$ by demanding that these longitudes each bound disks in the 2--handle.

%\begin{figure}[h!]
%	\begin{subfigure}[t]{0.45\textwidth}
%		\caption{Face block analogue: torus.} \label{fig:regular-pl-block-torus}
%	\end{subfigure}
%	\hfill
%	\begin{subfigure}[t]{0.45\textwidth}
%		\caption{Face block analogue: disk.} \label{fig:regular-pl-block-disk}
%	\end{subfigure}
%	
%	\caption{
%		\textbf{A face block analogue $B$ of $M$ and its projection through $f$ in the plane.}
%		$f(B)$ is a convex $n$--gon in the plane for some $n$ that is homeomorphic to either a closed solid torus or a 3--disk.
%%		The preimages of the corners of $f(B)$ are parallel longitudes of $B$, and we form a triangulated 2--handle containing $B$ by demanding that these longitudes each bound disks in the 2--handle.
%	}
%	\label{fig:regular-pl-blocks}
%\end{figure}


\subsection{Attach 3--handles}

We now have a triangulated 4--manifold with boundary components $M_0$ and the result of surgery on $M_1$ induced by 2--handle attachment.
This surgery had the following effect on $M_1$:
\begin{enumerate}
	\item Each solid torus in the partition of $M_1$ induced by the projection from Section ~\ref{section:pl-projection} is associated with a triangulated $D^4$ in Section ~\ref{section:pl-2-handle}.
	\item For each (torus, 2--handle) pair $(T, H^2)$, the boundary of $H^2$ contains $T$ and $T^* = H^2\setminus \interior{T}$ is another solid torus whose boundary triangulation is identical to that of $T$.
	\item Thus the effect of surgery on $M_1$ is of replacing each $T$ with $T^*$ over their shared boundary.
\end{enumerate}

